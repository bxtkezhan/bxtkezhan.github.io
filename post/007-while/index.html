<!DOCTYPE html>
<html lang="zh-cn">
<head>
<meta charset="utf-8">
<meta name="description" content="下面我们来让程序语言支持While语句，这会使得**bkcalclang**能够解决一些依赖循环结构处理的问题。">
<meta name="keywords" content="词法分析,语法分析,循环表达式,LL分析器,编程,编译原理,golang">
<meta name="author" content="bxtkezhan@kk">
<meta name="generator" content="Hugo 0.68.3" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="/css/style.css" type="text/css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Code+Pro:400,700" type="text/css">
<link rel="alternate" href="/index.xml" type="application/rss+xml" title="bxtkezhan@kk">
<title>支持While语句 - bxtkezhan@kk</title>
<script src="/js/player.js"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-7VMHQ286BK"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-7VMHQ286BK');
</script>
</head>
<body>

<header>
  <div class="container clearfix">
    <a class="path" href="http://bxtkezhan.xyz/">[bxtkezhan@kk]</a>
    <span class="caret"># _</span>
    <div class="right">
      
      
        <a class="path" style="color: var(--base0e)"href="/widle/">widle</a>
      
    </div>
  </div>
</header>

<div class="container">


<main role="main" class="article">
  
<article class="single" itemscope itemtype="http://schema.org/BlogPosting">
  <div class="meta">

    <span class="key">published on</span>
    <span class="val"><time itemprop="datePublished" datetime="2021-03-31">March 31, 2021</time></span>


    <span class="key">in</span>
    <span class="val">

        <a href="/categories/%E7%BC%96%E8%AF%91">编译</a>

    </span>


  </div>
  <h1 class="headline" itemprop="headline">支持While语句</h1>
  <section class="body" itemprop="articleBody">
    <p>下面我们来让程序语言支持While语句，这会使得<strong>bkcalclang</strong>能够解决一些依赖循环结构处理的问题。</p>
<p><a href="-"></a></p>
<p>这次的代码以上一篇<a href="https://www.bxtkezhan.xyz/post/006-if/">《支持If语句》</a>的代码为基础编写，如果发现不熟悉当下的内容可以回顾一下之前的篇章。</p>
<p><a href="-"></a></p>
<p>同样，直接放出<a href="#%E4%BB%A3%E7%A0%81%E6%B8%85%E5%8D%95">代码清单</a>有点劝退，先进行内容讲解。</p>
<p><a href="-"></a></p>
<h4 id="定义while节点的结构体">定义While节点的结构体</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">While</span> <span style="color:#66d9ef">struct</span> {
    <span style="color:#a6e22e">condition</span> <span style="color:#a6e22e">Node</span>
    <span style="color:#a6e22e">then</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Block</span>
}

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">NewWhile</span>(<span style="color:#a6e22e">condition</span> <span style="color:#a6e22e">Node</span>, <span style="color:#a6e22e">then</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Block</span>) <span style="color:#f92672">*</span><span style="color:#a6e22e">While</span> {
    <span style="color:#66d9ef">return</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">While</span>{<span style="color:#a6e22e">condition</span>: <span style="color:#a6e22e">condition</span>, <span style="color:#a6e22e">then</span>: <span style="color:#a6e22e">then</span>}
}
</code></pre></div><p><code>While</code>结构当中<code>condition</code>存储判断表达式节点，<code>then</code>存储代码块，使用<code>NewWhile</code>函数实例化。</p>
<p><a href="-"></a></p>
<h4 id="定义while节点的运行方法">定义While节点的运行方法</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">while</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">While</span>) <span style="color:#a6e22e">Eval</span>() <span style="color:#66d9ef">float64</span> {
    <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">while</span>.<span style="color:#a6e22e">condition</span>.<span style="color:#a6e22e">Eval</span>() <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span> {
        <span style="color:#a6e22e">while</span>.<span style="color:#a6e22e">then</span>.<span style="color:#a6e22e">Eval</span>();
    }
    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0.</span>
}
</code></pre></div><p>在循环结构中如果<code>While</code>的<code>condition</code>运行后的值不为0则始终运行代码块<code>then</code>，否则中断循环并返回0。</p>
<p><a href="-"></a></p>
<h4 id="处理while语句的解析">处理While语句的解析</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">    } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">token</span>.<span style="color:#a6e22e">Name</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;WHILE&#34;</span> {
        <span style="color:#a6e22e">lexer</span>.<span style="color:#a6e22e">NextToken</span>()
        <span style="color:#a6e22e">condition</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">parse_binary_add</span>(<span style="color:#a6e22e">lexer</span>)
        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">condition</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">nil</span>) {
            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
        }
        <span style="color:#a6e22e">token</span> = <span style="color:#a6e22e">lexer</span>.<span style="color:#a6e22e">GetToken</span>()
        <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">token</span>.<span style="color:#a6e22e">Name</span> <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;THEN&#34;</span> {
            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
        }
        <span style="color:#a6e22e">then</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">parse</span>(<span style="color:#a6e22e">lexer</span>)
        <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">then</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">nil</span> {
            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
        }
        <span style="color:#a6e22e">isBlockEnd</span> = <span style="color:#66d9ef">false</span>
        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">NewWhile</span>(<span style="color:#a6e22e">condition</span>, <span style="color:#a6e22e">then</span>)
</code></pre></div><p>我们在<code>parse_statement</code>函数中编写处理While语句的内容。</p>
<p><a href="-"></a></p>
<p>如果检测到<code>token.Name</code>为<code>WHILE</code>则尝试进行<code>While</code>语法解析，先跳过当前<code>token</code>然后进行表达式解析，若解析成功则将其作为<code>While</code>结构的<code>condition</code>成员:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">    } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">token</span>.<span style="color:#a6e22e">Name</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;WHILE&#34;</span> {
        <span style="color:#a6e22e">lexer</span>.<span style="color:#a6e22e">NextToken</span>()
        <span style="color:#a6e22e">condition</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">parse_binary_add</span>(<span style="color:#a6e22e">lexer</span>)
        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">condition</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">nil</span>) {
            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
        }
</code></pre></div><p><a href="-"></a></p>
<p>接下来取出下一个<code>token</code>判断如果为<code>THEN</code>就进行代码块解析，否则返回<code>nil</code>，在返回<code>NewWhile</code>前，我们需要设定<code>isBlockEnd</code>为<code>false</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">        <span style="color:#a6e22e">token</span> = <span style="color:#a6e22e">lexer</span>.<span style="color:#a6e22e">GetToken</span>()
        <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">token</span>.<span style="color:#a6e22e">Name</span> <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;THEN&#34;</span> {
            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
        }
        <span style="color:#a6e22e">then</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">parse</span>(<span style="color:#a6e22e">lexer</span>)
        <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">then</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">nil</span> {
            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
        }
        <span style="color:#a6e22e">isBlockEnd</span> = <span style="color:#66d9ef">false</span>
        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">NewWhile</span>(<span style="color:#a6e22e">condition</span>, <span style="color:#a6e22e">then</span>)
</code></pre></div><p><a href="-"></a></p>
<h4 id="定义词法解析器规则">定义词法解析器规则</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">lexer</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">BKLexer</span>.<span style="color:#a6e22e">NewLexer</span>()
<span style="color:#a6e22e">lexer</span>.<span style="color:#a6e22e">AddRule</span>(<span style="color:#e6db74">&#34;\\d+\\.?\\d*&#34;</span>, <span style="color:#e6db74">&#34;NUMBER&#34;</span>)
<span style="color:#a6e22e">lexer</span>.<span style="color:#a6e22e">AddRule</span>(<span style="color:#e6db74">&#34;[\\p{L}\\d_]+&#34;</span>, <span style="color:#e6db74">&#34;NAME&#34;</span>)
<span style="color:#a6e22e">lexer</span>.<span style="color:#a6e22e">AddRule</span>(<span style="color:#e6db74">&#34;\\+&#34;</span>, <span style="color:#e6db74">&#34;PLUS&#34;</span>)
<span style="color:#a6e22e">lexer</span>.<span style="color:#a6e22e">AddRule</span>(<span style="color:#e6db74">&#34;-&#34;</span>, <span style="color:#e6db74">&#34;MINUS&#34;</span>)
<span style="color:#a6e22e">lexer</span>.<span style="color:#a6e22e">AddRule</span>(<span style="color:#e6db74">&#34;\\*&#34;</span>, <span style="color:#e6db74">&#34;MUL&#34;</span>)
<span style="color:#a6e22e">lexer</span>.<span style="color:#a6e22e">AddRule</span>(<span style="color:#e6db74">&#34;/&#34;</span>, <span style="color:#e6db74">&#34;DIV&#34;</span>)
<span style="color:#a6e22e">lexer</span>.<span style="color:#a6e22e">AddRule</span>(<span style="color:#e6db74">&#34;\\(&#34;</span>, <span style="color:#e6db74">&#34;LPAR&#34;</span>)
<span style="color:#a6e22e">lexer</span>.<span style="color:#a6e22e">AddRule</span>(<span style="color:#e6db74">&#34;\\)&#34;</span>, <span style="color:#e6db74">&#34;RPAR&#34;</span>)
<span style="color:#a6e22e">lexer</span>.<span style="color:#a6e22e">AddRule</span>(<span style="color:#e6db74">&#34;=&#34;</span>, <span style="color:#e6db74">&#34;ASSIGN&#34;</span>)
<span style="color:#a6e22e">lexer</span>.<span style="color:#a6e22e">AddIgnores</span>(<span style="color:#e6db74">&#34;[ \\f\\t]+&#34;</span>)
<span style="color:#a6e22e">lexer</span>.<span style="color:#a6e22e">AddIgnores</span>(<span style="color:#e6db74">&#34;#[^\\r\\n]*&#34;</span>)
<span style="color:#a6e22e">lexer</span>.<span style="color:#a6e22e">AddReserve</span>(<span style="color:#e6db74">&#34;set&#34;</span>)
<span style="color:#a6e22e">lexer</span>.<span style="color:#a6e22e">AddReserve</span>(<span style="color:#e6db74">&#34;echo&#34;</span>)
<span style="color:#a6e22e">lexer</span>.<span style="color:#a6e22e">AddReserve</span>(<span style="color:#e6db74">&#34;if&#34;</span>)
<span style="color:#a6e22e">lexer</span>.<span style="color:#a6e22e">AddReserve</span>(<span style="color:#e6db74">&#34;while&#34;</span>)
<span style="color:#a6e22e">lexer</span>.<span style="color:#a6e22e">AddReserve</span>(<span style="color:#e6db74">&#34;then&#34;</span>)
<span style="color:#a6e22e">lexer</span>.<span style="color:#a6e22e">AddReserve</span>(<span style="color:#e6db74">&#34;end&#34;</span>)
</code></pre></div><p>这里我们需要添加<code>while</code>保留字。</p>
<p><a href="-"></a></p>
<h4 id="使用一段测试脚本进行测试">使用一段测试脚本进行测试</h4>
<p>测试内容【斐波那契数列】:</p>
<pre><code>set n = 15
set a = 0
set b = 1

while n then
    set n = n - 1
    set b = a + b
    set a = b - a
    echo a
end
</code></pre><p><a href="-"></a></p>
<p>运行结果:</p>
<pre><code>➜ go calc.go 

:= 1
:= 1
:= 2
:= 3
:= 5
:= 8
:= 13
:= 21
:= 34
:= 55
:= 89
:= 144
:= 233
:= 377
:= 610
</code></pre><p><a href="-"></a></p>
<h4 id="代码清单">代码清单</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>

<span style="color:#f92672">import</span> (
    <span style="color:#e6db74">&#34;fmt&#34;</span>
    <span style="color:#e6db74">&#34;strconv&#34;</span>
    <span style="color:#e6db74">&#34;io/ioutil&#34;</span>
    <span style="color:#e6db74">&#34;./bklexer&#34;</span>
)

<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">valueDict</span> <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">float64</span>

<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">isBlockEnd</span> <span style="color:#66d9ef">bool</span> = <span style="color:#66d9ef">false</span>

<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Node</span> <span style="color:#66d9ef">interface</span> {
    <span style="color:#a6e22e">Eval</span>() <span style="color:#66d9ef">float64</span>
}

<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Block</span> <span style="color:#66d9ef">struct</span> {
    <span style="color:#a6e22e">statements</span> []<span style="color:#a6e22e">Node</span>
}

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">NewBlock</span>() <span style="color:#f92672">*</span><span style="color:#a6e22e">Block</span> {
    <span style="color:#66d9ef">return</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">Block</span>{}
}

<span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">block</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Block</span>) <span style="color:#a6e22e">AddStatement</span>(<span style="color:#a6e22e">statement</span> <span style="color:#a6e22e">Node</span>) {
    <span style="color:#a6e22e">block</span>.<span style="color:#a6e22e">statements</span> = append(<span style="color:#a6e22e">block</span>.<span style="color:#a6e22e">statements</span>, <span style="color:#a6e22e">statement</span>)
}

<span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">block</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Block</span>) <span style="color:#a6e22e">Eval</span>() {
    <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">statement</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">block</span>.<span style="color:#a6e22e">statements</span> {
        <span style="color:#a6e22e">statement</span>.<span style="color:#a6e22e">Eval</span>()
    }
}

<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Number</span> <span style="color:#66d9ef">struct</span> {
    <span style="color:#a6e22e">value</span> <span style="color:#66d9ef">float64</span>
}

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">NewNumber</span>(<span style="color:#a6e22e">token</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">BKLexer</span>.<span style="color:#a6e22e">Token</span>) <span style="color:#f92672">*</span><span style="color:#a6e22e">Number</span> {
    <span style="color:#a6e22e">value</span>, <span style="color:#a6e22e">_</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">strconv</span>.<span style="color:#a6e22e">ParseFloat</span>(<span style="color:#a6e22e">token</span>.<span style="color:#a6e22e">Source</span>, <span style="color:#ae81ff">64</span>)
    <span style="color:#66d9ef">return</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">Number</span>{<span style="color:#a6e22e">value</span>: <span style="color:#a6e22e">value</span>}
}

<span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">number</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Number</span>) <span style="color:#a6e22e">Eval</span>() <span style="color:#66d9ef">float64</span> {
    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">number</span>.<span style="color:#a6e22e">value</span>
}

<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Name</span> <span style="color:#66d9ef">struct</span> {
    <span style="color:#a6e22e">name</span> <span style="color:#66d9ef">string</span>
}

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">NewName</span>(<span style="color:#a6e22e">token</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">BKLexer</span>.<span style="color:#a6e22e">Token</span>) <span style="color:#f92672">*</span><span style="color:#a6e22e">Name</span> {
    <span style="color:#66d9ef">return</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">Name</span>{<span style="color:#a6e22e">name</span>: <span style="color:#a6e22e">token</span>.<span style="color:#a6e22e">Source</span>}
}

<span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">name</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Name</span>) <span style="color:#a6e22e">Eval</span>() <span style="color:#66d9ef">float64</span> {
    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">value</span>, <span style="color:#a6e22e">found</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">valueDict</span>[<span style="color:#a6e22e">name</span>.<span style="color:#a6e22e">name</span>]; <span style="color:#a6e22e">found</span> {
        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">value</span>;
    }
    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0.</span>
}

<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">BinaryOpt</span> <span style="color:#66d9ef">struct</span> {
    <span style="color:#a6e22e">opt</span> <span style="color:#66d9ef">string</span>
    <span style="color:#a6e22e">lhs</span> <span style="color:#a6e22e">Node</span>
    <span style="color:#a6e22e">rhs</span> <span style="color:#a6e22e">Node</span>
}

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">NewBinaryOpt</span>(<span style="color:#a6e22e">token</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">BKLexer</span>.<span style="color:#a6e22e">Token</span>, <span style="color:#a6e22e">lhs</span> <span style="color:#a6e22e">Node</span>, <span style="color:#a6e22e">rhs</span> <span style="color:#a6e22e">Node</span>) <span style="color:#f92672">*</span><span style="color:#a6e22e">BinaryOpt</span> {
    <span style="color:#66d9ef">return</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">BinaryOpt</span>{<span style="color:#a6e22e">opt</span>: <span style="color:#a6e22e">token</span>.<span style="color:#a6e22e">Source</span>, <span style="color:#a6e22e">lhs</span>: <span style="color:#a6e22e">lhs</span>, <span style="color:#a6e22e">rhs</span>: <span style="color:#a6e22e">rhs</span>}
}

<span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">binaryOpt</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">BinaryOpt</span>) <span style="color:#a6e22e">Eval</span>() <span style="color:#66d9ef">float64</span> {
    <span style="color:#a6e22e">lhs</span>, <span style="color:#a6e22e">rhs</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">binaryOpt</span>.<span style="color:#a6e22e">lhs</span>, <span style="color:#a6e22e">binaryOpt</span>.<span style="color:#a6e22e">rhs</span>
    <span style="color:#66d9ef">switch</span> <span style="color:#a6e22e">binaryOpt</span>.<span style="color:#a6e22e">opt</span> {
        <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#34;+&#34;</span>: <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">lhs</span>.<span style="color:#a6e22e">Eval</span>() <span style="color:#f92672">+</span> <span style="color:#a6e22e">rhs</span>.<span style="color:#a6e22e">Eval</span>()
        <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#34;-&#34;</span>: <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">lhs</span>.<span style="color:#a6e22e">Eval</span>() <span style="color:#f92672">-</span> <span style="color:#a6e22e">rhs</span>.<span style="color:#a6e22e">Eval</span>()
        <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#34;*&#34;</span>: <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">lhs</span>.<span style="color:#a6e22e">Eval</span>() <span style="color:#f92672">*</span> <span style="color:#a6e22e">rhs</span>.<span style="color:#a6e22e">Eval</span>()
        <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#34;/&#34;</span>: <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">lhs</span>.<span style="color:#a6e22e">Eval</span>() <span style="color:#f92672">/</span> <span style="color:#a6e22e">rhs</span>.<span style="color:#a6e22e">Eval</span>()
    }
    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>
}

<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Assign</span> <span style="color:#66d9ef">struct</span> {
    <span style="color:#a6e22e">name</span> <span style="color:#66d9ef">string</span>
    <span style="color:#a6e22e">value</span> <span style="color:#a6e22e">Node</span>
}

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">NewAssign</span>(<span style="color:#a6e22e">token</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">BKLexer</span>.<span style="color:#a6e22e">Token</span>, <span style="color:#a6e22e">value</span> <span style="color:#a6e22e">Node</span>) <span style="color:#f92672">*</span><span style="color:#a6e22e">Assign</span> {
    <span style="color:#66d9ef">return</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">Assign</span>{<span style="color:#a6e22e">name</span>: <span style="color:#a6e22e">token</span>.<span style="color:#a6e22e">Source</span>, <span style="color:#a6e22e">value</span>: <span style="color:#a6e22e">value</span>}
}

<span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">assign</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Assign</span>) <span style="color:#a6e22e">Eval</span>() <span style="color:#66d9ef">float64</span> {
    <span style="color:#a6e22e">value</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">assign</span>.<span style="color:#a6e22e">value</span>.<span style="color:#a6e22e">Eval</span>()
    <span style="color:#a6e22e">valueDict</span>[<span style="color:#a6e22e">assign</span>.<span style="color:#a6e22e">name</span>] = <span style="color:#a6e22e">value</span>
    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">value</span>
}

<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Echo</span> <span style="color:#66d9ef">struct</span> {
    <span style="color:#a6e22e">value</span> <span style="color:#a6e22e">Node</span>
}

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">NewEcho</span>(<span style="color:#a6e22e">value</span> <span style="color:#a6e22e">Node</span>) <span style="color:#f92672">*</span><span style="color:#a6e22e">Echo</span> {
    <span style="color:#66d9ef">return</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">Echo</span>{<span style="color:#a6e22e">value</span>: <span style="color:#a6e22e">value</span>}
}

<span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">echo</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Echo</span>) <span style="color:#a6e22e">Eval</span>() <span style="color:#66d9ef">float64</span> {
    <span style="color:#a6e22e">value</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">echo</span>.<span style="color:#a6e22e">value</span>.<span style="color:#a6e22e">Eval</span>()
    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;:=&#34;</span>, <span style="color:#a6e22e">value</span>)
    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">value</span>
}

<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">If</span> <span style="color:#66d9ef">struct</span> {
    <span style="color:#a6e22e">condition</span> <span style="color:#a6e22e">Node</span>
    <span style="color:#a6e22e">then</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Block</span>
}

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">NewIf</span>(<span style="color:#a6e22e">condition</span> <span style="color:#a6e22e">Node</span>, <span style="color:#a6e22e">then</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Block</span>) <span style="color:#f92672">*</span><span style="color:#a6e22e">If</span> {
    <span style="color:#66d9ef">return</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">If</span>{<span style="color:#a6e22e">condition</span>: <span style="color:#a6e22e">condition</span>, <span style="color:#a6e22e">then</span>: <span style="color:#a6e22e">then</span>}
}

<span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">_if</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">If</span>) <span style="color:#a6e22e">Eval</span>() <span style="color:#66d9ef">float64</span> {
    <span style="color:#a6e22e">condition</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">_if</span>.<span style="color:#a6e22e">condition</span>.<span style="color:#a6e22e">Eval</span>()
    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">condition</span> <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span> {
        <span style="color:#a6e22e">_if</span>.<span style="color:#a6e22e">then</span>.<span style="color:#a6e22e">Eval</span>();
    }
    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0.</span>
}

<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">While</span> <span style="color:#66d9ef">struct</span> {
    <span style="color:#a6e22e">condition</span> <span style="color:#a6e22e">Node</span>
    <span style="color:#a6e22e">then</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Block</span>
}

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">NewWhile</span>(<span style="color:#a6e22e">condition</span> <span style="color:#a6e22e">Node</span>, <span style="color:#a6e22e">then</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Block</span>) <span style="color:#f92672">*</span><span style="color:#a6e22e">While</span> {
    <span style="color:#66d9ef">return</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">While</span>{<span style="color:#a6e22e">condition</span>: <span style="color:#a6e22e">condition</span>, <span style="color:#a6e22e">then</span>: <span style="color:#a6e22e">then</span>}
}

<span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">while</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">While</span>) <span style="color:#a6e22e">Eval</span>() <span style="color:#66d9ef">float64</span> {
    <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">while</span>.<span style="color:#a6e22e">condition</span>.<span style="color:#a6e22e">Eval</span>() <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span> {
        <span style="color:#a6e22e">while</span>.<span style="color:#a6e22e">then</span>.<span style="color:#a6e22e">Eval</span>();
    }
    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0.</span>
}

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">parse</span>(<span style="color:#a6e22e">lexer</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">BKLexer</span>.<span style="color:#a6e22e">Lexer</span>) <span style="color:#f92672">*</span><span style="color:#a6e22e">Block</span> {
    <span style="color:#a6e22e">block</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">NewBlock</span>()
    <span style="color:#a6e22e">token</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">lexer</span>.<span style="color:#a6e22e">NextToken</span>()
    <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">token</span>.<span style="color:#a6e22e">TType</span> <span style="color:#f92672">==</span> <span style="color:#a6e22e">BKLexer</span>.<span style="color:#a6e22e">TOKEN_TYPE_NEWLINE</span> {
        <span style="color:#a6e22e">token</span> = <span style="color:#a6e22e">lexer</span>.<span style="color:#a6e22e">NextToken</span>()
    }
    <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">token</span>.<span style="color:#a6e22e">TType</span> <span style="color:#f92672">!=</span> <span style="color:#a6e22e">BKLexer</span>.<span style="color:#a6e22e">TOKEN_TYPE_EOF</span> {
        <span style="color:#a6e22e">statement</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">parse_statement</span>(<span style="color:#a6e22e">lexer</span>)
        <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">isBlockEnd</span> {
            <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">block</span>
        }
        <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">statement</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">nil</span> {
            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>;
        }
        <span style="color:#a6e22e">token</span> = <span style="color:#a6e22e">lexer</span>.<span style="color:#a6e22e">GetToken</span>()
        <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">token</span>.<span style="color:#a6e22e">TType</span> <span style="color:#f92672">!=</span> <span style="color:#a6e22e">BKLexer</span>.<span style="color:#a6e22e">TOKEN_TYPE_NEWLINE</span> <span style="color:#f92672">&amp;&amp;</span>
           <span style="color:#a6e22e">token</span>.<span style="color:#a6e22e">TType</span> <span style="color:#f92672">!=</span> <span style="color:#a6e22e">BKLexer</span>.<span style="color:#a6e22e">TOKEN_TYPE_EOF</span> {
            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>;
        }
        <span style="color:#a6e22e">block</span>.<span style="color:#a6e22e">AddStatement</span>(<span style="color:#a6e22e">statement</span>)
        <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">token</span>.<span style="color:#a6e22e">TType</span> <span style="color:#f92672">==</span> <span style="color:#a6e22e">BKLexer</span>.<span style="color:#a6e22e">TOKEN_TYPE_NEWLINE</span> {
            <span style="color:#a6e22e">token</span> = <span style="color:#a6e22e">lexer</span>.<span style="color:#a6e22e">NextToken</span>()
        }
    }
    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">block</span>
}

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">parse_statement</span>(<span style="color:#a6e22e">lexer</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">BKLexer</span>.<span style="color:#a6e22e">Lexer</span>) <span style="color:#a6e22e">Node</span> {
    <span style="color:#a6e22e">token</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">lexer</span>.<span style="color:#a6e22e">GetToken</span>()
    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">token</span>.<span style="color:#a6e22e">Name</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;SET&#34;</span> {
        <span style="color:#a6e22e">name</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">lexer</span>.<span style="color:#a6e22e">NextToken</span>()
        <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">name</span>.<span style="color:#a6e22e">Name</span> <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;NAME&#34;</span> {
            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
        }
        <span style="color:#a6e22e">token</span> = <span style="color:#a6e22e">lexer</span>.<span style="color:#a6e22e">NextToken</span>()
        <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">token</span>.<span style="color:#a6e22e">Name</span> <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;ASSIGN&#34;</span> {
            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
        }
        <span style="color:#a6e22e">lexer</span>.<span style="color:#a6e22e">NextToken</span>()
        <span style="color:#a6e22e">value</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">parse_binary_add</span>(<span style="color:#a6e22e">lexer</span>)
        <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">value</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">nil</span> {
            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
        }
        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">NewAssign</span>(<span style="color:#a6e22e">name</span>, <span style="color:#a6e22e">value</span>)
    } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">token</span>.<span style="color:#a6e22e">Name</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;ECHO&#34;</span> {
        <span style="color:#a6e22e">lexer</span>.<span style="color:#a6e22e">NextToken</span>()
        <span style="color:#a6e22e">value</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">parse_binary_add</span>(<span style="color:#a6e22e">lexer</span>)
        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">value</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">nil</span>) {
            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
        }
        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">NewEcho</span>(<span style="color:#a6e22e">value</span>)
    } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">token</span>.<span style="color:#a6e22e">Name</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;IF&#34;</span> {
        <span style="color:#a6e22e">lexer</span>.<span style="color:#a6e22e">NextToken</span>()
        <span style="color:#a6e22e">condition</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">parse_binary_add</span>(<span style="color:#a6e22e">lexer</span>)
        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">condition</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">nil</span>) {
            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
        }
        <span style="color:#a6e22e">token</span> = <span style="color:#a6e22e">lexer</span>.<span style="color:#a6e22e">GetToken</span>()
        <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">token</span>.<span style="color:#a6e22e">Name</span> <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;THEN&#34;</span> {
            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
        }
        <span style="color:#a6e22e">then</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">parse</span>(<span style="color:#a6e22e">lexer</span>)
        <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">then</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">nil</span> {
            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
        }
        <span style="color:#a6e22e">isBlockEnd</span> = <span style="color:#66d9ef">false</span>
        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">NewIf</span>(<span style="color:#a6e22e">condition</span>, <span style="color:#a6e22e">then</span>)
    } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">token</span>.<span style="color:#a6e22e">Name</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;WHILE&#34;</span> {
        <span style="color:#a6e22e">lexer</span>.<span style="color:#a6e22e">NextToken</span>()
        <span style="color:#a6e22e">condition</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">parse_binary_add</span>(<span style="color:#a6e22e">lexer</span>)
        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">condition</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">nil</span>) {
            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
        }
        <span style="color:#a6e22e">token</span> = <span style="color:#a6e22e">lexer</span>.<span style="color:#a6e22e">GetToken</span>()
        <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">token</span>.<span style="color:#a6e22e">Name</span> <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;THEN&#34;</span> {
            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
        }
        <span style="color:#a6e22e">then</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">parse</span>(<span style="color:#a6e22e">lexer</span>)
        <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">then</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">nil</span> {
            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
        }
        <span style="color:#a6e22e">isBlockEnd</span> = <span style="color:#66d9ef">false</span>
        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">NewWhile</span>(<span style="color:#a6e22e">condition</span>, <span style="color:#a6e22e">then</span>)
    } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">token</span>.<span style="color:#a6e22e">Name</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;END&#34;</span> {
        <span style="color:#a6e22e">lexer</span>.<span style="color:#a6e22e">NextToken</span>()
        <span style="color:#a6e22e">isBlockEnd</span> = <span style="color:#66d9ef">true</span>
        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
    }
    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">parse_binary_add</span>(<span style="color:#a6e22e">lexer</span>)
}

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">parse_binary_add</span>(<span style="color:#a6e22e">lexer</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">BKLexer</span>.<span style="color:#a6e22e">Lexer</span>) <span style="color:#a6e22e">Node</span> {
    <span style="color:#a6e22e">lhs</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">parse_binary_mul</span>(<span style="color:#a6e22e">lexer</span>)
    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">lhs</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">nil</span> {
        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
    }
    <span style="color:#a6e22e">token</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">lexer</span>.<span style="color:#a6e22e">GetToken</span>()
    <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">token</span>.<span style="color:#a6e22e">Source</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;+&#34;</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">token</span>.<span style="color:#a6e22e">Source</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;-&#34;</span> {
        <span style="color:#a6e22e">lexer</span>.<span style="color:#a6e22e">NextToken</span>()
        <span style="color:#a6e22e">rhs</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">parse_binary_mul</span>(<span style="color:#a6e22e">lexer</span>)
        <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">rhs</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">nil</span> {
            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
        }
        <span style="color:#a6e22e">lhs</span> = <span style="color:#a6e22e">NewBinaryOpt</span>(<span style="color:#a6e22e">token</span>, <span style="color:#a6e22e">lhs</span>, <span style="color:#a6e22e">rhs</span>)
        <span style="color:#a6e22e">token</span> = <span style="color:#a6e22e">lexer</span>.<span style="color:#a6e22e">GetToken</span>()
    }
    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">lhs</span>
}

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">parse_binary_mul</span>(<span style="color:#a6e22e">lexer</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">BKLexer</span>.<span style="color:#a6e22e">Lexer</span>) <span style="color:#a6e22e">Node</span> {
    <span style="color:#a6e22e">lhs</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">factor</span>(<span style="color:#a6e22e">lexer</span>)
    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">lhs</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">nil</span> {
        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
    }
    <span style="color:#a6e22e">token</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">lexer</span>.<span style="color:#a6e22e">GetToken</span>()
    <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">token</span>.<span style="color:#a6e22e">Source</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;*&#34;</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">token</span>.<span style="color:#a6e22e">Source</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;/&#34;</span> {
        <span style="color:#a6e22e">lexer</span>.<span style="color:#a6e22e">NextToken</span>()
        <span style="color:#a6e22e">rhs</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">factor</span>(<span style="color:#a6e22e">lexer</span>)
        <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">rhs</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">nil</span> {
            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
        }
        <span style="color:#a6e22e">lhs</span> = <span style="color:#a6e22e">NewBinaryOpt</span>(<span style="color:#a6e22e">token</span>, <span style="color:#a6e22e">lhs</span>, <span style="color:#a6e22e">rhs</span>)
        <span style="color:#a6e22e">token</span> = <span style="color:#a6e22e">lexer</span>.<span style="color:#a6e22e">GetToken</span>()
    }
    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">lhs</span>
}

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">factor</span>(<span style="color:#a6e22e">lexer</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">BKLexer</span>.<span style="color:#a6e22e">Lexer</span>) <span style="color:#a6e22e">Node</span> {
    <span style="color:#a6e22e">token</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">lexer</span>.<span style="color:#a6e22e">GetToken</span>()
    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">token</span>.<span style="color:#a6e22e">Name</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;LPAR&#34;</span> {
        <span style="color:#a6e22e">lexer</span>.<span style="color:#a6e22e">NextToken</span>()
        <span style="color:#a6e22e">expr</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">parse_binary_add</span>(<span style="color:#a6e22e">lexer</span>)
        <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">expr</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">nil</span> {
            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
        }
        <span style="color:#a6e22e">token</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">lexer</span>.<span style="color:#a6e22e">GetToken</span>()
        <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">token</span>.<span style="color:#a6e22e">Name</span> <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;RPAR&#34;</span> {
            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
        }
        <span style="color:#a6e22e">lexer</span>.<span style="color:#a6e22e">NextToken</span>()
        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">expr</span>
    }
    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">token</span>.<span style="color:#a6e22e">Name</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;NUMBER&#34;</span> {
        <span style="color:#a6e22e">number</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">NewNumber</span>(<span style="color:#a6e22e">token</span>)
        <span style="color:#a6e22e">lexer</span>.<span style="color:#a6e22e">NextToken</span>()
        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">number</span>
    }
    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">token</span>.<span style="color:#a6e22e">Name</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;NAME&#34;</span> {
        <span style="color:#a6e22e">name</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">NewName</span>(<span style="color:#a6e22e">token</span>)
        <span style="color:#a6e22e">lexer</span>.<span style="color:#a6e22e">NextToken</span>()
        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">name</span>
    }
    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
}

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
    <span style="color:#a6e22e">lexer</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">BKLexer</span>.<span style="color:#a6e22e">NewLexer</span>()
    <span style="color:#a6e22e">lexer</span>.<span style="color:#a6e22e">AddRule</span>(<span style="color:#e6db74">&#34;\\d+\\.?\\d*&#34;</span>, <span style="color:#e6db74">&#34;NUMBER&#34;</span>)
    <span style="color:#a6e22e">lexer</span>.<span style="color:#a6e22e">AddRule</span>(<span style="color:#e6db74">&#34;[\\p{L}\\d_]+&#34;</span>, <span style="color:#e6db74">&#34;NAME&#34;</span>)
    <span style="color:#a6e22e">lexer</span>.<span style="color:#a6e22e">AddRule</span>(<span style="color:#e6db74">&#34;\\+&#34;</span>, <span style="color:#e6db74">&#34;PLUS&#34;</span>)
    <span style="color:#a6e22e">lexer</span>.<span style="color:#a6e22e">AddRule</span>(<span style="color:#e6db74">&#34;-&#34;</span>, <span style="color:#e6db74">&#34;MINUS&#34;</span>)
    <span style="color:#a6e22e">lexer</span>.<span style="color:#a6e22e">AddRule</span>(<span style="color:#e6db74">&#34;\\*&#34;</span>, <span style="color:#e6db74">&#34;MUL&#34;</span>)
    <span style="color:#a6e22e">lexer</span>.<span style="color:#a6e22e">AddRule</span>(<span style="color:#e6db74">&#34;/&#34;</span>, <span style="color:#e6db74">&#34;DIV&#34;</span>)
    <span style="color:#a6e22e">lexer</span>.<span style="color:#a6e22e">AddRule</span>(<span style="color:#e6db74">&#34;\\(&#34;</span>, <span style="color:#e6db74">&#34;LPAR&#34;</span>)
    <span style="color:#a6e22e">lexer</span>.<span style="color:#a6e22e">AddRule</span>(<span style="color:#e6db74">&#34;\\)&#34;</span>, <span style="color:#e6db74">&#34;RPAR&#34;</span>)
    <span style="color:#a6e22e">lexer</span>.<span style="color:#a6e22e">AddRule</span>(<span style="color:#e6db74">&#34;=&#34;</span>, <span style="color:#e6db74">&#34;ASSIGN&#34;</span>)
    <span style="color:#a6e22e">lexer</span>.<span style="color:#a6e22e">AddIgnores</span>(<span style="color:#e6db74">&#34;[ \\f\\t]+&#34;</span>)
    <span style="color:#a6e22e">lexer</span>.<span style="color:#a6e22e">AddIgnores</span>(<span style="color:#e6db74">&#34;#[^\\r\\n]*&#34;</span>)
    <span style="color:#a6e22e">lexer</span>.<span style="color:#a6e22e">AddReserve</span>(<span style="color:#e6db74">&#34;set&#34;</span>)
    <span style="color:#a6e22e">lexer</span>.<span style="color:#a6e22e">AddReserve</span>(<span style="color:#e6db74">&#34;echo&#34;</span>)
    <span style="color:#a6e22e">lexer</span>.<span style="color:#a6e22e">AddReserve</span>(<span style="color:#e6db74">&#34;if&#34;</span>)
    <span style="color:#a6e22e">lexer</span>.<span style="color:#a6e22e">AddReserve</span>(<span style="color:#e6db74">&#34;while&#34;</span>)
    <span style="color:#a6e22e">lexer</span>.<span style="color:#a6e22e">AddReserve</span>(<span style="color:#e6db74">&#34;then&#34;</span>)
    <span style="color:#a6e22e">lexer</span>.<span style="color:#a6e22e">AddReserve</span>(<span style="color:#e6db74">&#34;end&#34;</span>)

    <span style="color:#a6e22e">bytes</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">ioutil</span>.<span style="color:#a6e22e">ReadFile</span>(<span style="color:#e6db74">&#34;../test.txt&#34;</span>)
    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
        <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;read faild&#34;</span>)
        <span style="color:#66d9ef">return</span>
    }
    <span style="color:#a6e22e">code</span> <span style="color:#f92672">:=</span> string(<span style="color:#a6e22e">bytes</span>)
    <span style="color:#a6e22e">lexer</span>.<span style="color:#a6e22e">Build</span>(<span style="color:#a6e22e">code</span>)
    <span style="color:#a6e22e">result</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">parse</span>(<span style="color:#a6e22e">lexer</span>)
    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">result</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">nil</span> {
        <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;null result&#34;</span>)
        <span style="color:#66d9ef">return</span>
    }
    <span style="color:#a6e22e">valueDict</span> = make(<span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">float64</span>)
    <span style="color:#a6e22e">result</span>.<span style="color:#a6e22e">Eval</span>()
}
</code></pre></div>
  </section>
</article>

</main>

</div>

<footer>
  <div class="container">
    <span class="copyright">&copy; 2021 bxtkezhan@kk - <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></span>
  </div>
</footer>

</body>
</html>

